<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-02-21 Tue 10:54 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Recursion for SHACL</title>
<meta name="author" content="Maxime Jakubowski" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="/css/style.css" type="text/css"/>
</head>
<body>
<div id="preamble" class="status">

<nav id="post-home">
<ul><li><a href="/">Home</a></li></ul>
</nav>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Recursion for SHACL</h1>
</header><p>
The W3C recommendation that defines SHACL explicitly leaves recursion
undefined. In this post, I want to discuss this topic in light of
existing academic work:
</p>
<ul class="org-ul">
<li><a href="https://www.inf.unibz.it/krdb/KRDB%20files/tech-reports/KRDB18-01.pdf">Semantics and Validation of Recursive SHACL</a></li>
<li><a href="https://dbai.tuwien.ac.at/staff/simkus/papers/www-shacl-2020.pdf">Stable Model Semantics for Recursive SHACL</a></li>
<li>our own work <a href="https://arxiv.org/abs/2109.08285">Fixpoint Semantics for Recursive SHACL</a></li>
<li><a href="http://ceur-ws.org/Vol-3203/paper1.pdf">Well-Founded Semantics for Recursive SHACL</a></li>
</ul>
<p>
The goal of this post is to clarify what it means to add recursion to
SHACL, and to illustrate the ideas presented in these papers. I will
discuss the different semantics without defining them first. The
different semantics are:
</p>
<ul class="org-ul">
<li>Stratified Recursion,</li>
<li>Supported Model semantics,</li>
<li>Stable Model semantics, and</li>
<li>Well-Founded semantics.</li>
</ul>

<div id="outline-container-orgc51b7cb" class="outline-2">
<h2 id="orgc51b7cb">Recursive Shapes</h2>
<div class="outline-text-2" id="text-orgc51b7cb">
<p>
In SHACL, a shape is said to be recursive if it references itself
directly or indirectly. For example,
</p>
<div class="org-src-container">
<pre class="src src-ttl"><span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">Authorized</span> <span style="color: #b6a0ff;">a</span> <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">NodeShape</span> <span style="color: #b6a0ff;">;</span>
  <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">or</span> (
    [ <span style="color: #b6a0ff;">a</span> <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">PropertyShape</span> <span style="color: #b6a0ff;">;</span>
      <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">path</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">manuallyChecked</span> <span style="color: #b6a0ff;">;</span>
      <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">hasValue</span> true 
    ]
    [ <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">and</span> (
        [ <span style="color: #b6a0ff;">a</span> <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">PropertyShape</span> <span style="color: #b6a0ff;">;</span>
          <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">path</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">connected</span> <span style="color: #b6a0ff;">;</span>
          <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">qualifiedValueShape</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">Authorized</span> <span style="color: #b6a0ff;">;</span>
          <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">qualifiedMinCount</span> 1 
        ]
        [ <span style="color: #b6a0ff;">a</span> <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">PropertyShape</span> <span style="color: #b6a0ff;">;</span>
          <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">path</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">threatLevel</span> <span style="color: #b6a0ff;">;</span>
          <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">hasValue</span> 0
        ]
      )
    ]
  )
</pre>
</div>
<p>
In natural language, a node is <code>:Authorized</code> if it is
<code>:manuallyChecked</code>, or if it has a <code>:threatLevel</code> of <code>0</code> and it is
connected to an <code>:Authorized</code> node. Two things to note about this
shape. First, it is clearly recursive, as it mentions itself through
the <code>sh:qualifiedValueShape</code>. Second, it mentions itself <i>positively</i>.
SHACL is a very powerful language that supports negation of shapes
with the <code>sh:not</code> keyword.
An example of mentioning itself <i>negatively</i> would be:
</p>
<div class="org-src-container">
<pre class="src src-ttl"><span style="color: #b6a0ff;">...</span>
[ <span style="color: #b6a0ff;">a</span> <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">PropertyShape</span> <span style="color: #b6a0ff;">;</span>
  <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">path</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">connected</span> <span style="color: #b6a0ff;">;</span>
  <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">qualifiedValueShape</span> [ <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">not</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">Authorized</span> ] <span style="color: #b6a0ff;">;</span>
  <span style="color: #6ae4b9;">sh:</span><span style="color: #00bcff;">qualifiedMinCount</span> 1 
]
<span style="color: #b6a0ff;">...</span>
</pre>
</div>
<p>
Although in this example, that would make little sense.
</p>

<p>
When talking about recursion, negation adds an extra layer of
complexity to the discussion. Almost all of the differences between
the proposed semantics are due to negation. However, for the
purposes of this post, I'll start without it and work our way up.
</p>
</div>
</div>

<div id="outline-container-orgbdc6efe" class="outline-2">
<h2 id="orgbdc6efe">Basic Semantics for Recursion</h2>
<div class="outline-text-2" id="text-orgbdc6efe">
<p>
We will discuss the basics through our <code>:Authorized</code> example. Consider
the following data graph:
</p>
<div class="org-src-container">
<pre class="src src-ttl"><span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n0</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">manuallyChecked</span> true <span style="color: #b6a0ff;">;</span>
    <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">connected</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n1</span> <span style="color: #6ae4b9;">.</span>
<span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n1</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">connected</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n0</span> <span style="color: #b6a0ff;">;</span>
    <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">connected</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n2</span> <span style="color: #b6a0ff;">;</span>
    <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">threatLevel</span> 0 <span style="color: #6ae4b9;">.</span>
<span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n2</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">connected</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n1</span> <span style="color: #b6a0ff;">;</span>
    <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">threatLevel</span> 0 <span style="color: #6ae4b9;">.</span>

<span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n3</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">connected</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n4</span> <span style="color: #b6a0ff;">;</span>
    <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">threatLevel</span> 0 <span style="color: #6ae4b9;">.</span>
<span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n4</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">connected</span> <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">n3</span> <span style="color: #b6a0ff;">;</span>
    <span style="color: #6ae4b9;">:</span><span style="color: #00bcff;">threatLevel</span> 0 <span style="color: #b6a0ff;">.</span>
</pre>
</div>
<p>
Which of the nodes <code>:n0</code> through <code>:n4</code> could be said to be <code>:Authorized</code>?
That is the question we need to be able to answer when we have
defined recursive semantics for SHACL.
</p>

<p>
Stratified recursion, Well-Founded, and Stable Model semantics all
agree that the set of <code>:Authorized</code> nodes needs to be: <code>:n0</code>, <code>:n1</code>, and
<code>:n2</code>. Supported Model semantics, however, states that there is an
additional possible set of <code>:Authorized</code> nodes: all of them!
</p>

<p>
The idea behind Supported Model semantics is that there is a
possible assignment of shape names to nodes, such that all labelled
nodes satisfy the shape. In this case, when both <code>:n3</code> and <code>:n4</code> are
labelled to be <code>:Authorized</code>, then they also both satisfy the
<code>:Authorized</code> shape.
</p>

<p>
For the other semantics, the idea in this case is to have a minimal
assignment of shape names to nodes. This is commonly referred to as
the <i>minimal model semantics</i> in logic programming literature.
</p>
</div>
</div>

<div id="outline-container-org00a3ddc" class="outline-2">
<h2 id="org00a3ddc">Adding negation</h2>
</div>
</div>
<div id="postamble" class="status">
<hr/>
<footer>
<div class="copyright-container">
<div class="copyright">
Copyright &copy; 2020-2022 Maxime Jakubowski some rights reserved<br/>
Content is available under
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
CC-BY-SA 4.0</a> unless otherwise noted
</div>
<div class="cc-badge">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License"
     src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
</a>
</div>
</div>
<div class="generated">
Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2). Last updated: 2023-02-21 Tue 10:52.
</div>
</footer>
</div>
</body>
</html>
